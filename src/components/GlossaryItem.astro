---
import type { Concept } from '../lib/types';
import RichTextRenderer from './RichTextRenderer';

const { concept } = Astro.props as { concept: Concept };

const term = concept.term ?? concept.title ?? concept.name ?? '';
const slug = concept.slug ?? (term ? term.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9\-]/g, '') : '');

const short =
  concept.shortDefinition ??
  (concept as any).summary ??
  (concept as any).definition ??
  '';

const whatItIs =
  (concept as any).whatItIs ??
  (concept as any).what_is ??
  (concept as any).whatIsText ??
  '';

const whatItIsNot =
  (concept as any).whatItIsNot ??
  (concept as any).what_is_not ??
  (concept as any).whatNotText ??
  '';

const related = concept.relatedConcepts ?? [];
---

<article
  class="rounded-2xl border border-slate-200 bg-white/60 p-6 shadow-sm backdrop-blur dark:border-white/10 dark:bg-white/5"
  id={slug}
>
  <div class="flex items-start justify-between gap-4">
    <div>
      <h3 class="text-xl font-semibold text-slate-900 dark:text-white">{term}</h3>
      {short ? (
        <p class="mt-1 text-sm text-slate-600 dark:text-white/70">{short}</p>
      ) : null}
    </div>

    <button
      type="button"
      data-copy-link={slug}
      class="shrink-0 rounded-full border border-slate-200 bg-white/70 px-3 py-1 text-xs font-semibold text-slate-700 hover:bg-white dark:border-white/10 dark:bg-white/10 dark:text-white/80 dark:hover:bg-white/15"
      aria-label={`Copy link to ${term}`}
      title="Copy link"
    >
      Copy
    </button>
  </div>

  {/* Optional rich content (kept) */}
  {concept.fullDefinition && (
    <div class="prose prose-slate mt-4 max-w-none dark:prose-invert">
      <RichTextRenderer value={concept.fullDefinition} />
    </div>
  )}

  {(whatItIs || whatItIsNot) && (
    <div class="mt-4 grid gap-3">
      {whatItIs && (
        <div class="rounded-2xl border border-slate-200 bg-white/70 p-4 text-sm dark:border-white/10 dark:bg-white/5">
          <p class="text-xs font-semibold uppercase tracking-wide text-slate-700 dark:text-white/70">What it is</p>
          <p class="mt-2 text-slate-700 dark:text-white/80">{whatItIs}</p>
        </div>
      )}

      {whatItIsNot && (
        <div class="rounded-2xl border border-slate-200 bg-white/70 p-4 text-sm dark:border-white/10 dark:bg-white/5">
          <p class="text-xs font-semibold uppercase tracking-wide text-slate-700 dark:text-white/70">What it is not</p>
          <p class="mt-2 text-slate-700 dark:text-white/80">{whatItIsNot}</p>
        </div>
      )}
    </div>
  )}

  {related?.length ? (
    <p class="pt-4 text-sm text-slate-600 dark:text-white/70">
      Related: {related.map((r) => (r.term ?? (r as any).title ?? (r as any).name)).join(', ')}
    </p>
  ) : null}
</article>
